version: '3'
networks:
  proxy:
services:
  traefik:
      image: traefik
      restart: unless-stopped
      command: --api --docker
      networks:
        - proxy
      ports:
        - "80:80"
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
      labels:
        - "traefik.backend=traefik"
        - "traefik.frontend.rule=Host:traefik.localhost"
        - "traefik.port=8080"
  tls-client:
    container_name: tls-client
    build:
      context: .
      args:
        - PKG=client
    image:
      tlsclient:latest
    volumes:
      - ${GOPATH}/src/github.com/chrispaynes/goTLS/pkg/client:/go/src/client
    restart: always
    networks:
      - proxy
    labels:
      - "traefik.backend=client"
      - "traefik.frontend.rule=Host:tls.client.localhost"
      - "traefik.docker.network=proxy"
  tls-server:
    container_name: tls-server
    build:
      context: .
      args:
        - PKG=server
    image:
      tlsserver:latest
    volumes:
      - ${GOPATH}/src/github.com/chrispaynes/goTLS/pkg/server:/go/src/server
      - ${GOPATH}/src/github.com/chrispaynes/goTLS/cert/server.crt:/go/src/server/server.crt
      - ${GOPATH}/src/github.com/chrispaynes/goTLS/cert/server.key:/go/src/server/server.key
    restart: always
    networks:
      - proxy
    ports:
      - "8443:8443"
    labels:
      - "traefik.backend=server"
      - "traefik.frontend.rule=Host:tls.server.localhost"
      - "traefik.docker.network=proxy"
      - "traefik.port=8443"

